<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpringDemo管理系统</title>
    <!-- 引入Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 引入Font Awesome图标 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- 引入自定义样式 -->
    <link href="/springdemo/css/admin.css" rel="stylesheet">
    <style>
        /* 添加顶部导航栏固定定位样式 */
        .top-navbar {
            position: fixed;
            top: 0;
            right: 0;
            left: 220px; /* 侧边栏宽度 */
            z-index: 1000;
            background-color: #fff;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            padding: 10px 20px;
        }
        
        /* 调整内容区域的上边距，避免被固定导航栏遮挡 */
        .content {
            margin-top: 60px;
        }
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            .top-navbar {
                left: 0;
            }
            
            .sidebar.show + .main-content .top-navbar {
                left: 220px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="admin-container">
            <!-- 侧边栏 -->
            <div class="sidebar">
                <div class="sidebar-header">
                    SpringDemo 控制台
                </div>
                <ul class="sidebar-menu">
                    <li class="menu-item" :class="{ active: active === 'home' }">
                        <a href="#/">
                            <i class="fas fa-home"></i>
                            <span>首页</span>
                        </a>
                    </li>
                    <li class="menu-item" :class="{ active: active === 'dashboard' }">
                        <a href="#/dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>仪表盘</span>
                        </a>
                    </li>
                    <li class="menu-item" :class="{ active: active === 'users' }">
                        <a href="#/users">
                            <i class="fas fa-users"></i>
                            <span>用户管理</span>
                        </a>
                    </li>
                    <li class="menu-item" :class="{ active: active === 'batch' }">
                        <a href="#/batch">
                            <i class="fas fa-tasks"></i>
                            <span>批处理管理</span>
                        </a>
                    </li>
                    <li class="menu-item" :class="{ active: active === 'monitor', open: active === 'monitor' }">
                        <a href="javascript:void(0);" @click="toggleSubmenu('monitor')">
                            <i class="fas fa-chart-line"></i>
                            <span>监控模块</span>
                            <span class="menu-arrow">
                                <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                        <ul class="submenu">
                            <li class="submenu-item" :class="{ active: subActive === 'realtime' }">
                                <a href="#/monitor/realtime">实时监控</a>
                            </li>
                            <li class="submenu-item" :class="{ active: subActive === 'logs' }">
                                <a href="#/monitor/logs">日志查看</a>
                            </li>
                            <li class="submenu-item" :class="{ active: subActive === 'metrics' }">
                                <a href="#/monitor/metrics">性能指标</a>
                            </li>
                        </ul>
                    </li>
                    <li class="menu-item" :class="{ active: active === 'settings' }">
                        <a href="#/settings">
                            <i class="fas fa-cog"></i>
                            <span>系统设置</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- 主内容区 -->
            <div class="main-content">
                <!-- 顶部导航栏 -->
                <div class="top-navbar">
                    <div class="breadcrumb">
                        <div class="breadcrumb-item" v-if="active !== 'home'">
                            <a href="#/">首页</a>
                        </div>
                        <div v-for="(breadcrumb, index) in breadcrumbs" :key="index" 
                             class="breadcrumb-item" :class="{ active: breadcrumb.active }">
                            <a v-if="!breadcrumb.active" :href="'#' + breadcrumb.url">{{ breadcrumb.name }}</a>
                            <span v-if="breadcrumb.active">{{ breadcrumb.name }}</span>
                        </div>
                    </div>
                    <div class="user-menu">
                        <div class="dropdown">
                            <span>
                                <i class="fas fa-user-circle"></i>
                                <span>{{ username || '管理员' }}</span>
                                <i class="fas fa-chevron-down"></i>
                            </span>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="#/profile">
                                    <i class="fas fa-user"></i> 个人信息
                                </a>
                                <a class="dropdown-item" href="/springdemo/logout">
                                    <i class="fas fa-sign-out-alt"></i> 退出登录
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 内容区域 -->
                <div class="content">
                    <component :is="currentView" 
                               :system-info="systemInfo"
                               :breadcrumbs="breadcrumbs"></component>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.36/dist/vue.global.min.js"></script>
    <!-- 引入Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- 引入jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- 引入Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 引入Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- 组件模板 -->
    <script type="text/x-template" id="dashboard-template">
        <div>
            <div class="page-header">
                <h1 class="page-title">仪表盘</h1>
            </div>

            <div class="row">
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-card-icon bg-primary">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-card-title">用户总数</div>
                            <div class="stat-card-value">{{ userCount }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-card-icon bg-success">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-card-title">批处理作业</div>
                            <div class="stat-card-value">{{ jobCount }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-card-icon bg-info">
                            <i class="fas fa-server"></i>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-card-title">系统负载</div>
                            <div class="stat-card-value">{{ systemLoad }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-card-icon bg-warning">
                            <i class="fas fa-memory"></i>
                        </div>
                        <div class="stat-card-info">
                            <div class="stat-card-title">内存使用</div>
                            <div class="stat-card-value">{{ memoryUsage }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">用户统计</h2>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="userChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">系统状态</h2>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="systemChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">最近批处理作业</h2>
                            <a href="#/batch" class="btn btn-sm btn-primary">查看全部</a>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>作业ID</th>
                                            <th>作业名称</th>
                                            <th>开始时间</th>
                                            <th>结束时间</th>
                                            <th>状态</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-if="!recentJobs || recentJobs.length === 0">
                                            <td colspan="5" class="text-center">暂无批处理作业</td>
                                        </tr>
                                        <tr v-for="job in recentJobs" :key="job.id" v-else>
                                            <td>{{ job.id }}</td>
                                            <td>{{ job.name }}</td>
                                            <td>{{ job.startTime }}</td>
                                            <td>{{ job.endTime }}</td>
                                            <td>
                                                <span class="batch-status" 
                                                      :class="{
                                                          'status-completed': job.status === 'COMPLETED',
                                                          'status-failed': job.status === 'FAILED',
                                                          'status-running': job.status === 'RUNNING',
                                                          'status-stopped': job.status !== 'COMPLETED' && job.status !== 'FAILED' && job.status !== 'RUNNING'
                                                      }">
                                                    {{ job.status }}
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <!-- 主页模板 -->
    <script type="text/x-template" id="home-template">
        <div>
            <div class="page-header">
                <h1 class="page-title">欢迎使用SpringDemo管理系统</h1>
            </div>
            
            <!-- 测试热加载的元素 -->
            <div class="hot-reload-test">
                这是一个测试热加载功能的元素 - 修改于 {{ new Date().toLocaleString() }}
            </div>
            
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> 请从左侧菜单选择要管理的模块。
            </div>
            
            <div class="row">
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <i class="fas fa-users fa-3x mb-3 text-primary"></i>
                            <h3>用户管理</h3>
                            <p>管理系统用户，包括添加、编辑、删除用户等操作。</p>
                            <a href="#/users" class="btn btn-primary">进入</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <i class="fas fa-tasks fa-3x mb-3 text-success"></i>
                            <h3>批处理管理</h3>
                            <p>管理批处理作业，包括导入用户、数据处理等操作。</p>
                            <a href="#/batch" class="btn btn-success">进入</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <i class="fas fa-chart-line fa-3x mb-3 text-info"></i>
                            <h3>监控模块</h3>
                            <p>监控系统运行状态，包括性能指标、日志查看等。</p>
                            <a href="#/monitor" class="btn btn-info">进入</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <i class="fas fa-cog fa-3x mb-3 text-secondary"></i>
                            <h3>系统设置</h3>
                            <p>配置系统参数，包括邮件设置、安全设置等。</p>
                            <a href="#/settings" class="btn btn-secondary">进入</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">系统信息</h2>
                        </div>
                        <div class="card-body">
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <th width="30%">系统版本</th>
                                        <td>SpringDemo v1.0.0</td>
                                    </tr>
                                    <tr>
                                        <th>操作系统</th>
                                        <td>{{ systemInfo.osName }}</td>
                                    </tr>
                                    <tr>
                                        <th>Java版本</th>
                                        <td>{{ systemInfo.javaVersion }}</td>
                                    </tr>
                                    <tr>
                                        <th>Spring Boot版本</th>
                                        <td>2.7.5</td>
                                    </tr>
                                    <tr>
                                        <th>服务器时间</th>
                                        <td>{{ systemInfo.serverTime }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">最近活动</h2>
                        </div>
                        <div class="card-body">
                            <ul class="timeline">
                                <li class="timeline-item" v-for="activity in recentActivities" :key="activity.id">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <h3 class="timeline-title">{{ activity.title }}</h3>
                                        <p>{{ activity.description }}</p>
                                        <p class="timeline-date">{{ activity.time }}</p>
                                    </div>
                                </li>
                                <li class="timeline-item" v-if="!recentActivities || recentActivities.length === 0">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <h3 class="timeline-title">暂无活动</h3>
                                        <p>系统尚未记录任何活动。</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <!-- 设置页面模板 -->
    <script type="text/x-template" id="settings-template">
        <div>
            <div class="page-header">
                <h1 class="page-title">系统设置</h1>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">基本设置</h2>
                </div>
                <div class="card-body">
                    <form>
                        <div class="mb-3">
                            <label for="siteName" class="form-label">系统名称</label>
                            <input type="text" class="form-control" id="siteName" v-model="settings.siteName">
                        </div>
                        <div class="mb-3">
                            <label for="siteDescription" class="form-label">系统描述</label>
                            <textarea class="form-control" id="siteDescription" rows="3" v-model="settings.siteDescription"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="adminEmail" class="form-label">管理员邮箱</label>
                            <input type="email" class="form-control" id="adminEmail" v-model="settings.adminEmail">
                        </div>
                        <button type="button" class="btn btn-primary" @click="saveSettings">保存设置</button>
                    </form>
                </div>
            </div>
        </div>
    </script>

    <!-- 应用脚本 -->
    <script>
        // 定义组件
        const Dashboard = {
            template: '#dashboard-template',
            props: ['systemInfo', 'breadcrumbs'],
            data() {
                return {
                    userCount: 0,
                    jobCount: 0,
                    systemLoad: '0%',
                    memoryUsage: '0%',
                    recentJobs: []
                }
            },
            mounted() {
                this.fetchDashboardData();
                this.initCharts();
            },
            methods: {
                fetchDashboardData() {
                    // 这里应该从API获取数据
                    // 模拟数据
                    this.userCount = 100;
                    this.jobCount = 5;
                    this.systemLoad = '25%';
                    this.memoryUsage = '40%';
                    this.recentJobs = [];
                },
                initCharts() {
                    // 用户统计图表
                    const userCtx = document.getElementById('userChart').getContext('2d');
                    const userChart = new Chart(userCtx, {
                        type: 'bar',
                        data: {
                            labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                            datasets: [{
                                label: '新增用户',
                                data: [12, 19, 3, 5, 2, 3],
                                backgroundColor: 'rgba(58, 142, 230, 0.2)',
                                borderColor: 'rgba(58, 142, 230, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                    
                    // 系统状态图表
                    const systemCtx = document.getElementById('systemChart').getContext('2d');
                    const systemChart = new Chart(systemCtx, {
                        type: 'line',
                        data: {
                            labels: ['1小时前', '50分钟前', '40分钟前', '30分钟前', '20分钟前', '10分钟前', '现在'],
                            datasets: [{
                                label: 'CPU使用率',
                                data: [30, 35, 40, 50, 45, 40, 35],
                                backgroundColor: 'rgba(58, 142, 230, 0.2)',
                                borderColor: 'rgba(58, 142, 230, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
            }
        };

        const Home = {
            template: '#home-template',
            props: ['systemInfo'],
            data() {
                return {
                    recentActivities: []
                }
            },
            mounted() {
                // 模拟获取最近活动数据
                this.recentActivities = [
                    {
                        id: 1,
                        title: '系统更新',
                        description: '系统已更新到最新版本。',
                        time: '2023-01-01 12:00:00'
                    },
                    {
                        id: 2,
                        title: '用户登录',
                        description: '管理员登录了系统。',
                        time: '2023-01-01 11:30:00'
                    }
                ];
            }
        };

        const Settings = {
            template: '#settings-template',
            data() {
                return {
                    settings: {
                        siteName: 'SpringDemo管理系统',
                        siteDescription: '这是一个Spring Boot与Vue集成的演示项目',
                        adminEmail: 'admin@example.com'
                    }
                }
            },
            methods: {
                saveSettings() {
                    // 模拟保存设置
                    alert('设置已保存');
                }
            }
        };

        // 创建Vue应用
        const app = Vue.createApp({
            data() {
                return {
                    active: 'home',
                    subActive: '',
                    username: 'admin',
                    breadcrumbs: [],
                    systemInfo: {
                        osName: 'Mac OS X',
                        javaVersion: '1.8.0_361',
                        serverTime: new Date().toLocaleString()
                    },
                    currentView: 'home'
                }
            },
            mounted() {
                // 初始化路由
                this.handleRoute();
                window.addEventListener('hashchange', this.handleRoute);
                
                // 获取系统信息
                this.fetchSystemInfo();
            },
            methods: {
                toggleSubmenu(menu) {
                    if (this.active === menu) {
                        this.active = '';
                    } else {
                        this.active = menu;
                    }
                },
                handleRoute() {
                    const hash = window.location.hash || '#/';
                    const path = hash.substring(1);
                    
                    if (path === '/' || path === '') {
                        this.active = 'home';
                        this.currentView = 'home';
                        this.breadcrumbs = [
                            { name: '首页', url: '/', active: true }
                        ];
                    } else if (path === '/dashboard') {
                        this.active = 'dashboard';
                        this.currentView = 'dashboard';
                        this.breadcrumbs = [
                            { name: '仪表盘', url: '/dashboard', active: true }
                        ];
                    } else if (path === '/settings') {
                        this.active = 'settings';
                        this.currentView = 'settings';
                        this.breadcrumbs = [
                            { name: '系统设置', url: '/settings', active: true }
                        ];
                    }
                },
                fetchSystemInfo() {
                    // 从API获取系统信息
                    axios.get('/springdemo/api/admin/dashboard')
                        .then(response => {
                            this.systemInfo = response.data;
                        })
                        .catch(error => {
                            console.error('获取系统信息失败:', error);
                        });
                }
            },
            components: {
                'dashboard': Dashboard,
                'home': Home,
                'settings': Settings
            }
        });
        
        // 挂载应用
        app.mount('#app');
    </script>
</body>
</html> 